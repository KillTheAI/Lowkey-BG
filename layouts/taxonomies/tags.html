{{ define "main" }} 

<div class="flex flex-col gap-1">
  <h1 class="title-small">
    {{ if .Params.header }}
      {{ .Params.header }}
    {{ else }}
      {{ .Title }}
    {{ end }}
  </h1>

  {{ with .Content }}
    {{ . }}
  {{ end }}
</div>

<section class="py-10">
  <!-- Tags Word Cloud -->
  <div class="tags-wordcloud-container">
    {{ $maxCount := 0 }}
    {{ $minCount := 999999 }}
    {{ $totalTags := 0 }}
    
    <!-- Enhanced color palette with better distribution -->
    {{ $colorSets := slice 
        (dict "light" "text-blue-500" "dark" "text-blue-400" "weight" "font-semibold")
        (dict "light" "text-emerald-600" "dark" "text-emerald-400" "weight" "font-medium")
        (dict "light" "text-purple-600" "dark" "text-purple-400" "weight" "font-bold")
        (dict "light" "text-rose-500" "dark" "text-rose-400" "weight" "font-medium")
        (dict "light" "text-amber-600" "dark" "text-amber-400" "weight" "font-semibold")
        (dict "light" "text-indigo-600" "dark" "text-indigo-400" "weight" "font-bold")
        (dict "light" "text-pink-500" "dark" "text-pink-400" "weight" "font-medium")
        (dict "light" "text-teal-600" "dark" "text-teal-400" "weight" "font-semibold")
        (dict "light" "text-orange-500" "dark" "text-orange-400" "weight" "font-medium")
        (dict "light" "text-violet-600" "dark" "text-violet-400" "weight" "font-bold")
        (dict "light" "text-cyan-600" "dark" "text-cyan-400" "weight" "font-medium")
        (dict "light" "text-lime-600" "dark" "text-lime-400" "weight" "font-semibold")
    }}
    
    <!-- First pass: calculate statistics -->
    {{ range $name, $taxonomy := .Site.Taxonomies.tags }}
      {{ $count := len $taxonomy.Pages }}
      {{ $totalTags = add $totalTags 1 }}
      {{ if gt $count $maxCount }}
        {{ $maxCount = $count }}
      {{ end }}
      {{ if lt $count $minCount }}
        {{ $minCount = $count }}
      {{ end }}
    {{ end }}
    
    <!-- Second pass: render tags with improved algorithm -->
    {{ $tagIndex := 0 }}
    {{ range $name, $taxonomy := .Site.Taxonomies.tags }}
      {{ $count := len $taxonomy.Pages }}
      
      <!-- Improved size calculation with logarithmic scaling -->
      {{ $logWeight := 0 }}
      {{ if gt $maxCount $minCount }}
        {{ $ratio := div (float (sub $count $minCount)) (float (sub $maxCount $minCount)) }}
        {{ $logWeight = mul (math.Log (add $ratio 0.1)) 0.5 }}
        {{ $logWeight = add $logWeight 1 }}
        {{ if lt $logWeight 0 }}{{ $logWeight = 0.2 }}{{ end }}
        {{ if gt $logWeight 1 }}{{ $logWeight = 1 }}{{ end }}
      {{ else }}
        {{ $logWeight = 0.5 }}
      {{ end }}
      
      <!-- Map to size classes with better distribution -->
      {{ $sizeClass := "text-sm" }}
      {{ $baseWeight := "font-normal" }}
      {{ if ge $logWeight 0.9 }}
        {{ $sizeClass = "text-5xl" }}
        {{ $baseWeight = "font-black" }}
      {{ else if ge $logWeight 0.8 }}
        {{ $sizeClass = "text-4xl" }}
        {{ $baseWeight = "font-extrabold" }}
      {{ else if ge $logWeight 0.7 }}
        {{ $sizeClass = "text-3xl" }}
        {{ $baseWeight = "font-bold" }}
      {{ else if ge $logWeight 0.6 }}
        {{ $sizeClass = "text-2xl" }}
        {{ $baseWeight = "font-bold" }}
      {{ else if ge $logWeight 0.5 }}
        {{ $sizeClass = "text-xl" }}
        {{ $baseWeight = "font-semibold" }}
      {{ else if ge $logWeight 0.4 }}
        {{ $sizeClass = "text-lg" }}
        {{ $baseWeight = "font-medium" }}
      {{ else if ge $logWeight 0.3 }}
        {{ $sizeClass = "text-base" }}
        {{ $baseWeight = "font-medium" }}
      {{ else }}
        {{ $sizeClass = "text-sm" }}
        {{ $baseWeight = "font-normal" }}
      {{ end }}
      
      <!-- Color selection with better distribution -->
      {{ $colorIndex := mod (add $tagIndex (len $name)) (len $colorSets) }}
      {{ $colorSet := index $colorSets $colorIndex }}
      {{ $lightColor := $colorSet.light }}
      {{ $darkColor := $colorSet.dark }}
      {{ $colorWeight := $colorSet.weight }}
      
      <!-- Use color weight if base weight is normal, otherwise use base weight -->
      {{ $finalWeight := $baseWeight }}
      {{ if eq $baseWeight "font-normal" }}
        {{ $finalWeight = $colorWeight }}
      {{ end }}
      
      <!-- Render tag with enhanced styling -->
      <span class="tag-cloud-word {{ $sizeClass }} {{ $finalWeight }} {{ $lightColor }} dark:{{ $darkColor }}"
            data-count="{{ $count }}"
            data-weight="{{ $logWeight }}"
            data-index="{{ $tagIndex }}">
        <a href="{{ "/tags/" | relLangURL }}{{ $name | urlize }}" 
           class="tag-link"
           title="{{ $name }} ({{ $count }} {{ if eq $count 1 }}post{{ else }}posts{{ end }})">
          {{ $name }}
        </a>
      </span>
      
      {{ $tagIndex = add $tagIndex 1 }}
    {{ end }}
  </div>
</section>

{{ end }}